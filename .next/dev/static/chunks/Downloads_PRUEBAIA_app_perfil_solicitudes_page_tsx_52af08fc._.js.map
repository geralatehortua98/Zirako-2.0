{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/PRUEBAIA/app/perfil/solicitudes/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card } from \"@/components/ui/card\"\r\nimport { ChevronLeft, CheckCircle, XCircle, Loader2, DollarSign, Gift, User } from \"lucide-react\"\r\nimport Link from \"next/link\"\r\nimport Image from \"next/image\"\r\nimport { toast } from \"sonner\"\r\n\r\ninterface Solicitud {\r\n  id: number\r\n  tipo: 'venta' | 'donacion'\r\n  valor: number\r\n  mensaje: string\r\n  item_titulo: string\r\n  item_imagenes: string[]\r\n  solicitante_nombre: string\r\n  created_at: string\r\n}\r\n\r\nexport default function SolicitudesPage() {\r\n  const [solicitudes, setSolicitudes] = useState<Solicitud[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [processingId, setProcessingId] = useState<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    fetchSolicitudes()\r\n  }, [])\r\n\r\n  const fetchSolicitudes = async () => {\r\n    try {\r\n      const res = await fetch(\"/api/solicitudes\")\r\n      const data = await res.json()\r\n      if (data.success) setSolicitudes(data.data)\r\n    } catch (error) { console.error(error) } \r\n    finally { setLoading(false) }\r\n  }\r\n\r\n  const handleAction = async (id: number, tipo: string, accion: 'aceptar' | 'rechazar') => {\r\n      setProcessingId(id)\r\n      try {\r\n          const res = await fetch(\"/api/solicitudes\", {\r\n              method: \"PUT\",\r\n              headers: { \"Content-Type\": \"application/json\" },\r\n              body: JSON.stringify({ id, tipo, accion })\r\n          })\r\n          const data = await res.json()\r\n          \r\n          if (data.success) {\r\n              setSolicitudes(prev => prev.filter(s => s.id !== id))\r\n              if(accion === 'aceptar') {\r\n                  toast.success(\"¡Transacción completada! Puntos sumados.\")\r\n              } else {\r\n                  toast.info(\"Solicitud rechazada.\")\r\n              }\r\n          }\r\n      } catch (error) { console.error(error) } \r\n      finally { setProcessingId(null) }\r\n  }\r\n\r\n  const formatPrice = (p: number) => new Intl.NumberFormat(\"es-CO\", { style: \"currency\", currency: \"COP\", minimumFractionDigits: 0 }).format(p)\r\n\r\n  if (loading) return <div className=\"min-h-screen bg-primary flex justify-center items-center\"><Loader2 className=\"animate-spin text-white h-8 w-8\"/></div>\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-primary\">\r\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\r\n        <div className=\"flex items-center gap-4 mb-8\">\r\n          <Link href=\"/perfil\"><Button variant=\"outline\" className=\"bg-accent text-accent-foreground border-accent hover:bg-accent/90 h-10 px-4 flex items-center gap-2\"><ChevronLeft className=\"h-5 w-5\" /> Regresar</Button></Link>\r\n          <h1 className=\"text-2xl font-bold text-white\">Solicitudes Recibidas</h1>\r\n        </div>\r\n\r\n        {solicitudes.length === 0 ? (\r\n            <Card className=\"bg-secondary border-secondary p-12 text-center\">\r\n                <p className=\"text-primary-foreground/60\">No tienes solicitudes pendientes.</p>\r\n            </Card>\r\n        ) : (\r\n            <div className=\"space-y-4\">\r\n                {solicitudes.map((sol) => (\r\n                    <Card key={`${sol.tipo}-${sol.id}`} className=\"bg-secondary border-secondary p-5\">\r\n                        <div className=\"flex flex-col md:flex-row gap-4 items-start\">\r\n                            <div className=\"relative w-20 h-20 bg-black/20 rounded-lg overflow-hidden flex-shrink-0\">\r\n                                <Image src={sol.item_imagenes[0] || '/placeholder.svg'} alt=\"item\" fill className=\"object-cover\"/>\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                                <div className=\"flex items-center justify-between mb-1\">\r\n                                    <h3 className=\"font-bold text-lg text-white\">{sol.item_titulo}</h3>\r\n                                    {sol.tipo === 'venta' ? (\r\n                                        <span className=\"text-green-400 font-bold flex items-center gap-1\"><DollarSign className=\"h-4 w-4\"/> Oferta: {formatPrice(sol.valor)}</span>\r\n                                    ) : (\r\n                                        <span className=\"text-purple-400 font-bold flex items-center gap-1\"><Gift className=\"h-4 w-4\"/> Piden Donación</span>\r\n                                    )}\r\n                                </div>\r\n                                <p className=\"text-sm text-white/70 flex items-center gap-2 mb-2\">\r\n                                    <User className=\"h-4 w-4\"/> De: <span className=\"font-semibold text-white\">{sol.solicitante_nombre}</span>\r\n                                </p>\r\n                                <div className=\"bg-primary/20 p-3 rounded-lg text-sm text-white/80 italic border border-white/5\">\r\n                                    &quot;{sol.mensaje}&quot;\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 pt-4 border-t border-white/10 flex justify-end gap-3\">\r\n                            <Button \r\n                                onClick={() => handleAction(sol.id, sol.tipo, 'rechazar')}\r\n                                disabled={processingId === sol.id}\r\n                                variant=\"outline\" \r\n                                className=\"border-red-500/50 text-red-400 hover:bg-red-500/10 bg-transparent\"\r\n                            >\r\n                                Rechazar\r\n                            </Button>\r\n                            <Button \r\n                                onClick={() => handleAction(sol.id, sol.tipo, 'aceptar')}\r\n                                disabled={processingId === sol.id}\r\n                                className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                            >\r\n                                {processingId === sol.id ? <Loader2 className=\"animate-spin h-4 w-4\"/> : <><CheckCircle className=\"mr-2 h-4 w-4\"/> Aceptar y Finalizar</>}\r\n                            </Button>\r\n                        </div>\r\n                    </Card>\r\n                ))}\r\n            </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}