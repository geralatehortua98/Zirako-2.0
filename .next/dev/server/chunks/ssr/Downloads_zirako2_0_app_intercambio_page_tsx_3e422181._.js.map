{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/app/intercambio/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\nimport { ChevronLeft, Package, Loader2, RefreshCw, Search, CheckCircle, XCircle, ArrowRight } from \"lucide-react\"\nimport Link from \"next/link\"\nimport { useState, useEffect } from \"react\"\nimport Image from \"next/image\"\nimport { useRouter } from \"next/navigation\"\n\ninterface ExchangeProposal {\n  id: number\n  titulo_ofrecido: string\n  titulo_solicitado: string\n  imagenes_ofrecido: string[]\n  imagenes_solicitado: string[]\n  nombre_propone: string\n  nombre_recibe: string\n  estado: string\n  created_at: string\n  usuario_propone_id: number\n  usuario_recibe_id: number\n}\n\nexport default function IntercambioPage() {\n  const router = useRouter()\n  const [proposals, setProposals] = useState<ExchangeProposal[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState(\"\")\n  const [actionLoading, setActionLoading] = useState<number | null>(null)\n  const [currentUserId, setCurrentUserId] = useState<number | null>(null)\n\n  useEffect(() => {\n    // Obtener ID del usuario actual para saber si recibí o envié la propuesta\n    const storedId = localStorage.getItem(\"zirako_user_id\")\n    if (storedId) setCurrentUserId(Number(storedId))\n    \n    fetchExchanges()\n  }, [])\n\n  const fetchExchanges = async () => {\n    try {\n      const response = await fetch(\"/api/exchanges\")\n      const data = await response.json()\n\n      if (data.success) {\n        setProposals(data.data || [])\n      } else {\n        setError(data.error || \"Error al cargar intercambios\")\n      }\n    } catch (err) {\n      setError(\"Error de conexión\")\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleUpdateStatus = async (id: number, nuevoEstado: \"aceptado\" | \"rechazado\") => {\n    setActionLoading(id)\n    try {\n      const response = await fetch(\"/api/exchanges\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ id, estado: nuevoEstado }),\n      })\n\n      const data = await response.json()\n\n      if (response.ok && data.success) {\n        setProposals((prev) => \n            prev.map((p) => (p.id === id ? { ...p, estado: nuevoEstado } : p))\n        )\n      } else {\n          console.error(\"Error backend:\", data.error)\n      }\n    } catch (err) {\n      console.error(\"Error al actualizar:\", err)\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-primary\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href=\"/dashboard\">\n            <Button\n              variant=\"outline\"\n              className=\"bg-accent text-accent-foreground border-accent hover:bg-accent/90 h-10 px-4 flex items-center gap-2\"\n            >\n              <ChevronLeft className=\"h-5 w-5\" />\n              Regresar\n            </Button>\n          </Link>\n        </div>\n\n        {/* ENCABEZADO PRINCIPAL */}\n        <Card className=\"bg-secondary border-secondary p-8 mb-8 text-center\">\n          <div className=\"bg-accent rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4 shadow-lg\">\n             <RefreshCw className=\"h-10 w-10 text-primary\" />\n          </div>\n          <h1 className=\"text-3xl font-bold text-primary-foreground mb-2\">Zona de Intercambios</h1>\n          <p className=\"text-primary-foreground/70 mb-6\">Gestiona tus trueques y encuentra nuevas oportunidades</p>\n          \n          {/* type=intercambio' */}\n          <Link href=\"/buscar?type=intercambio\">\n            <Button className=\"bg-orange-500 hover:bg-orange-600 text-white font-bold h-12 px-8 text-lg shadow-lg transition-transform hover:scale-105\">\n                <Search className=\"mr-2 h-5 w-5\"/> Ver Productos para Intercambiar\n            </Button>\n          </Link>\n        </Card>\n\n        {/* LISTA DE PROPUESTAS */}\n        <div className=\"mb-6 flex items-center justify-between\">\n            <h2 className=\"text-xl font-bold text-white\">Mis Propuestas</h2>\n            <span className=\"text-xs bg-white/10 px-3 py-1 rounded-full text-white\">{proposals.length} total</span>\n        </div>\n\n        {isLoading ? (\n            <div className=\"flex justify-center py-12\"><Loader2 className=\"h-8 w-8 animate-spin text-accent\" /></div>\n        ) : proposals.length === 0 ? (\n            <div className=\"text-center py-12 bg-secondary/20 rounded-xl border border-white/10\">\n                <Package className=\"h-16 w-16 text-white/20 mx-auto mb-4\" />\n                <p className=\"text-white/60 text-lg\">Aún no tienes intercambios activos</p>\n                <p className=\"text-sm text-white/40 mt-2\">¡Explora productos y haz tu primera propuesta!</p>\n            </div>\n        ) : (\n            <div className=\"space-y-4\">\n              {proposals.map((proposal) => {\n                const soyElQueRecibe = currentUserId === proposal.usuario_recibe_id\n                \n                return (\n                <Card key={proposal.id} className={`bg-secondary border-secondary p-0 overflow-hidden ${proposal.estado !== 'pendiente' ? 'opacity-80' : ''}`}>\n                  {/* Estado Header */}\n                  <div className={`px-4 py-2 text-xs font-bold text-center uppercase tracking-widest ${\n                      proposal.estado === 'pendiente' ? 'bg-yellow-500/20 text-yellow-500' :\n                      proposal.estado === 'aceptado' ? 'bg-green-500/20 text-green-400' :\n                      'bg-red-500/20 text-red-400'\n                  }`}>\n                      {proposal.estado}\n                  </div>\n\n                  <div className=\"p-5\">\n                    <div className=\"flex flex-col md:flex-row items-center gap-6\">\n                      \n                      {/* LADO IZQUIERDO (Lo que ofrecen) */}\n                      <div className=\"flex-1 w-full bg-primary/30 p-3 rounded-xl border border-white/5\">\n                         <p className=\"text-xs text-orange-400 mb-2 font-bold flex items-center gap-1\">\n                            {soyElQueRecibe ? \"TE OFRECEN:\" : \"TÚ OFRECES:\"}\n                         </p>\n                         <div className=\"flex items-center gap-3\">\n                            <div className=\"relative w-16 h-16 rounded-lg overflow-hidden bg-black/20 flex-shrink-0\">\n                                <Image src={proposal.imagenes_ofrecido[0] || \"/placeholder.svg\"} alt=\"img\" fill className=\"object-cover\"/>\n                            </div>\n                            <div className=\"min-w-0\">\n                                <p className=\"font-bold text-white truncate\">{proposal.titulo_ofrecido}</p>\n                                <p className=\"text-xs text-white/50\">Usuario: {proposal.nombre_propone}</p>\n                            </div>\n                         </div>\n                      </div>\n\n                      {/* ICONO CENTRAL */}\n                      <div className=\"flex-shrink-0 bg-orange-500/20 p-3 rounded-full\">\n                         <RefreshCw className=\"h-6 w-6 text-orange-500\" />\n                      </div>\n\n                      {/* LADO DERECHO (Lo que piden) */}\n                      <div className=\"flex-1 w-full bg-primary/30 p-3 rounded-xl border border-white/5\">\n                         <p className=\"text-xs text-green-400 mb-2 font-bold flex items-center gap-1\">\n                            {soyElQueRecibe ? \"POR TU ARTÍCULO:\" : \"A CAMBIO DE:\"}\n                         </p>\n                         <div className=\"flex items-center gap-3\">\n                            <div className=\"relative w-16 h-16 rounded-lg overflow-hidden bg-black/20 flex-shrink-0\">\n                                <Image src={proposal.imagenes_solicitado[0] || \"/placeholder.svg\"} alt=\"img\" fill className=\"object-cover\"/>\n                            </div>\n                            <div className=\"min-w-0\">\n                                <p className=\"font-bold text-white truncate\">{proposal.titulo_solicitado}</p>\n                                {soyElQueRecibe ? (\n                                    <p className=\"text-xs text-white/50\">Es tuyo</p>\n                                ) : (\n                                    <p className=\"text-xs text-white/50\">De: {proposal.nombre_recibe}</p>\n                                )}\n                            </div>\n                         </div>\n                      </div>\n                    </div>\n                    \n                    {/* ACCIONES (Solo si soy el que recibe y está pendiente) */}\n                    {proposal.estado === 'pendiente' && soyElQueRecibe && (\n                        <div className=\"mt-6 flex gap-3 justify-end pt-4 border-t border-white/10\">\n                            <Button \n                                onClick={() => handleUpdateStatus(proposal.id, 'rechazado')}\n                                disabled={actionLoading === proposal.id}\n                                variant=\"outline\" \n                                className=\"border-red-500/50 text-red-400 hover:bg-red-500/10\"\n                            >\n                                <XCircle className=\"mr-2 h-4 w-4\"/> Rechazar\n                            </Button>\n                            <Button \n                                onClick={() => handleUpdateStatus(proposal.id, 'aceptado')}\n                                disabled={actionLoading === proposal.id}\n                                className=\"bg-green-600 hover:bg-green-700 text-white\"\n                            >\n                                {actionLoading === proposal.id ? <Loader2 className=\"animate-spin h-4 w-4\"/> : <><CheckCircle className=\"mr-2 h-4 w-4\"/> Aceptar Intercambio</>}\n                            </Button>\n                        </div>\n                    )}\n\n                    {/* MENSAJE DE ESTADO*/}\n                    {proposal.estado === 'aceptado' && (\n                        <div className=\"mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded-lg text-center\">\n                            <p className=\"text-green-400 text-sm font-medium\">¡Intercambio Aceptado! Revisa tu correo para contactar a la otra parte.</p>\n                        </div>\n                    )}\n                    {proposal.estado === 'rechazado' && (\n                        <div className=\"mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-center\">\n                            <p className=\"text-red-400 text-sm font-medium\">Has rechazado esta propuesta.</p>\n                        </div>\n                    )}\n                  </div>\n                </Card>\n              )})}\n            </div>\n        )}\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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","debugId":null}}]
}