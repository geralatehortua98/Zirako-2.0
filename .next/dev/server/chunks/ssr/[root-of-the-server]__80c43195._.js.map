{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\n// 1. Declarar variable global para evitar múltiples conexiones en modo desarrollo\ndeclare global {\n  var mysqlPool: mysql.Pool | undefined\n}\n\nlet pool: mysql.Pool\n\n// 2. Configuración de la conexión\n// Usamos las variables de entorno que configuramos en .env.local\nconst dbConfig = {\n  uri: process.env.DATABASE_URL, // Prioridad a la URL completa\n  host: process.env.MYSQL_HOST,\n  user: process.env.MYSQL_USER,\n  password: process.env.MYSQL_PASSWORD,\n  database: process.env.MYSQL_DATABASE,\n  port: Number(process.env.MYSQL_PORT) || 3306,\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true, // Vital para Railway\n  keepAliveInitialDelay: 0,\n}\n\n// 3. Lógica Singleton: Si ya existe un pool, úsalo. Si no, créalo.\nif (!global.mysqlPool) {\n  // Si hay una URL completa (DATABASE_URL), úsala\n  if (process.env.DATABASE_URL) {\n      global.mysqlPool = mysql.createPool({\n          uri: process.env.DATABASE_URL,\n          waitForConnections: true,\n          connectionLimit: 10,\n          enableKeepAlive: true\n      })\n  } else {\n      // Si no, usa los parámetros individuales\n      global.mysqlPool = mysql.createPool(dbConfig)\n  }\n}\n\npool = global.mysqlPool\n\n// 4. Función helper para ejecutar queries\nexport async function query<T = any>(sql: string, params?: any[]): Promise<{ rows: T[]; fields?: any }> {\n  try {\n    const [rows, fields] = await pool.execute(sql, params || [])\n    return { rows: rows as T[], fields }\n  } catch (error) {\n    console.error(\"[ZIRAKO DB] Error ejecutando query:\", error)\n    throw error\n  }\n}\n\n// 5. Verificar conexión (Opcional, para debugging)\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const connection = await pool.getConnection()\n    await connection.ping()\n    connection.release()\n    console.log(\"[ZIRAKO DB] Conexión a MySQL Railway exitosa\")\n    return true\n  } catch (error) {\n    console.error(\"[ZIRAKO DB] Error conectando a MySQL Railway:\", error)\n    return false\n  }\n}\n\nexport default pool"],"names":[],"mappings":";;;;;;;;AAAA;;AAOA,IAAI;AAEJ,kCAAkC;AAClC,iEAAiE;AACjE,MAAM,WAAW;IACf,KAAK,QAAQ,GAAG,CAAC,YAAY;IAC7B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,KAAK;IACxC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AACzB;AAEA,mEAAmE;AACnE,IAAI,CAAC,OAAO,SAAS,EAAE;IACrB,gDAAgD;IAChD,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC1B,OAAO,SAAS,GAAG,6NAAK,CAAC,UAAU,CAAC;YAChC,KAAK,QAAQ,GAAG,CAAC,YAAY;YAC7B,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;QACrB;IACJ,OAAO;QACH,yCAAyC;QACzC,OAAO,SAAS,GAAG,6NAAK,CAAC,UAAU,CAAC;IACxC;AACF;AAEA,OAAO,OAAO,SAAS;AAGhB,eAAe,MAAe,GAAW,EAAE,MAAc;IAC9D,IAAI;QACF,MAAM,CAAC,MAAM,OAAO,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK,UAAU,EAAE;QAC3D,OAAO;YAAE,MAAM;YAAa;QAAO;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,MAAM;IACR;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,MAAM,WAAW,IAAI;QACrB,WAAW,OAAO;QAClB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO;IACT;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport jwt from \"jsonwebtoken\"\nimport { query } from \"./db\"\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"zirako-secret-key-2024-change-in-production\"\nconst JWT_EXPIRES_IN = \"7d\"\n\n// Interfaz para el payload del JWT\nexport interface JWTPayload {\n  userId: number\n  email: string\n  name: string\n}\n\n// Interfaz para los datos de registro\ninterface RegisterProps {\n  email: string\n  password: string\n  name: string\n  rol_id: number // Ahora es el ID de la tabla roles\n  tipo_documento: string\n  numero_documento: string\n  phone?: string\n  ciudad?: string\n  direccion?: string\n}\n\n// Hash de contraseña\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = await bcrypt.genSalt(12)\n  return bcrypt.hash(password, salt)\n}\n\n// Verificar contraseña\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\n// Generar token JWT\nexport function generateToken(payload: JWTPayload): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\n}\n\n// Verificar token JWT\nexport function verifyToken(token: string): JWTPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as JWTPayload\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al verificar token:\", error)\n    return null\n  }\n}\n\n// Generar token de verificación de email\nexport function generateVerificationToken(): string {\n  return jwt.sign({ purpose: \"email-verification\" }, JWT_SECRET, { expiresIn: \"24h\" })\n}\n\n// Generar token de recuperación de contraseña\nexport function generatePasswordResetToken(): string {\n  return jwt.sign({ purpose: \"password-reset\" }, JWT_SECRET, { expiresIn: \"1h\" })\n}\n\n// Registrar nuevo usuario\nexport async function registerUser({\n  email,\n  password,\n  name,\n  rol_id,\n  tipo_documento,\n  numero_documento,\n  phone,\n  ciudad,\n  direccion\n}: RegisterProps) {\n  try {\n    // Verificar si el usuario ya existe\n    const existingUser = await query<any>(\"SELECT id FROM usuarios WHERE email = ?\", [email])\n    if (existingUser.rows.length > 0) {\n      return { success: false, error: \"El correo electrónico ya está registrado\" }\n    }\n\n    // Verificar si el documento ya existe\n    const existingDoc = await query<any>(\"SELECT id FROM usuarios WHERE numero_documento = ?\", [numero_documento])\n    if (existingDoc.rows.length > 0) {\n      return { success: false, error: \"El número de documento ya está registrado\" }\n    }\n\n    // Hash de la contraseña\n    const passwordHash = await hashPassword(password)\n    const verificationToken = generateVerificationToken()\n\n    // Insertar usuario (usando rol_id)\n    await query<any>(\n      `INSERT INTO usuarios (\n          email, password_hash, nombre, rol_id, tipo_documento, numero_documento, \n          telefono, ciudad, direccion, token_verificacion, puntos, nivel\n       ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0, 1)`,\n      [\n        email, \n        passwordHash, \n        name, \n        rol_id || 1, // Por defecto rol 1 (Persona) si no viene\n        tipo_documento || 'CC', \n        numero_documento, \n        phone || null, \n        ciudad || \"Cali\", \n        direccion || null, \n        verificationToken\n      ],\n    )\n\n    // Obtener el usuario insertado con el nombre de su rol\n    const newUser = await query<any>(\n      `SELECT u.id, u.email, u.nombre, r.nombre as rol, u.created_at \n       FROM usuarios u \n       JOIN roles r ON u.rol_id = r.id \n       WHERE u.email = ?`,\n      [email],\n    )\n\n    const user = newUser.rows[0]\n\n    return {\n      success: true,\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.nombre,\n        rol: user.rol, // Devolvemos el nombre del rol (ej: 'empresa')\n        createdAt: user.created_at,\n      },\n      verificationToken,\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error registro:\", error)\n    return { success: false, error: \"Error interno al registrar\" }\n  }\n}\n\n// Iniciar sesión\nexport async function loginUser(email: string, password: string) {\n  try {\n    // Buscar usuario por email y obtener el nombre de su rol\n    const result = await query<any>(\n      `SELECT u.id, u.email, u.password_hash, u.nombre, r.nombre as rol, \n              u.telefono, u.ciudad, u.puntos, u.nivel, u.email_verificado \n       FROM usuarios u\n       JOIN roles r ON u.rol_id = r.id\n       WHERE u.email = ?`,\n      [email],\n    )\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Credenciales inválidas\" }\n    }\n\n    const user = result.rows[0]\n\n    // Verificar contraseña\n    const isValidPassword = await verifyPassword(password, user.password_hash)\n\n    if (!isValidPassword) {\n      return { success: false, error: \"Credenciales inválidas\" }\n    }\n\n    await query(\"UPDATE usuarios SET ultimo_login = NOW() WHERE id = ?\", [user.id])\n\n    // Generar token JWT\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n      name: user.nombre,\n    })\n\n    return {\n      success: true,\n      token,\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.nombre,\n        rol: user.rol,\n        phone: user.telefono,\n        city: user.ciudad,\n        points: user.puntos,\n        level: user.nivel || 1,\n        emailVerified: user.email_verificado,\n      },\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al iniciar sesión:\", error)\n    return { success: false, error: \"Error al iniciar sesión\" }\n  }\n}\n\n// Verificar email\nexport async function verifyEmail(token: string) {\n  try {\n    const result = await query<any>(\"SELECT id, email, nombre FROM usuarios WHERE token_verificacion = ?\", [token])\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Token de verificación inválido\" }\n    }\n\n    const user = result.rows[0]\n\n    await query(\"UPDATE usuarios SET email_verificado = TRUE, token_verificacion = NULL WHERE id = ?\", [user.id])\n\n    return { success: true, message: \"Email verificado exitosamente\", user }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al verificar email:\", error)\n    return { success: false, error: \"Error al verificar email\" }\n  }\n}\n\n// Solicitar recuperación de contraseña\nexport async function requestPasswordReset(email: string) {\n  try {\n    const result = await query<any>(\"SELECT id, nombre FROM usuarios WHERE email = ?\", [email])\n\n    if (result.rows.length === 0) {\n      return { success: true, message: \"Si el correo existe, recibirás un enlace de recuperación\" }\n    }\n\n    const user = result.rows[0]\n    const resetToken = generatePasswordResetToken()\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000) // 1 hora\n\n    await query(\"UPDATE usuarios SET token_reset_password = ?, reset_password_expira = ? WHERE id = ?\", [\n      resetToken,\n      expiresAt,\n      user.id,\n    ])\n\n    return { success: true, resetToken, user }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error recuperación contraseña:\", error)\n    return { success: false, error: \"Error al procesar la solicitud\" }\n  }\n}\n\n// Restablecer contraseña\nexport async function resetPassword(token: string, newPassword: string) {\n  try {\n    const result = await query<any>(\n      \"SELECT id FROM usuarios WHERE token_reset_password = ? AND reset_password_expira > NOW()\",\n      [token],\n    )\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Token inválido o expirado\" }\n    }\n\n    const user = result.rows[0]\n    const passwordHash = await hashPassword(newPassword)\n\n    await query(\n      \"UPDATE usuarios SET password_hash = ?, token_reset_password = NULL, reset_password_expira = NULL WHERE id = ?\",\n      [passwordHash, user.id],\n    )\n\n    return { success: true, message: \"Contraseña actualizada exitosamente\" }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error restablecer contraseña:\", error)\n    return { success: false, error: \"Error al restablecer contraseña\" }\n  }\n}\n\n// Obtener usuario por ID (con rol desde la tabla roles)\nexport async function getUserById(id: number) {\n  try {\n    const result = await query<any>(\n      `SELECT u.id, u.email, u.nombre, r.nombre as rol, u.telefono, u.ciudad, u.direccion, \n              u.puntos, u.nivel, u.email_verificado, u.created_at \n       FROM usuarios u\n       JOIN roles r ON u.rol_id = r.id\n       WHERE u.id = ?`,\n      [id],\n    )\n\n    if (result.rows.length === 0) return null\n\n    const user = result.rows[0]\n    return {\n      id: user.id,\n      email: user.email,\n      name: user.nombre,\n      rol: user.rol,\n      phone: user.telefono,\n      city: user.ciudad,\n      address: user.direccion,\n      points: user.puntos,\n      level: user.nivel || 1,\n      emailVerified: user.email_verificado,\n      createdAt: user.created_at,\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error obtener usuario:\", error)\n    return null\n  }\n}\n\nexport async function addPointsToUser(userId: number, points: number, reason: string) {\n  try {\n    await query(\"UPDATE usuarios SET puntos = puntos + ? WHERE id = ?\", [points, userId])\n\n    // Recalcular nivel\n    const result = await query<any>(\"SELECT puntos FROM usuarios WHERE id = ?\", [userId])\n    if (result.rows.length > 0) {\n      const totalPoints = result.rows[0].puntos\n      let newLevel = 1\n      if (totalPoints >= 1000) newLevel = 5 \n      else if (totalPoints >= 500) newLevel = 4 \n      else if (totalPoints >= 200) newLevel = 3 \n      else if (totalPoints >= 50) newLevel = 2 \n\n      await query(\"UPDATE usuarios SET nivel = ? WHERE id = ?\", [newLevel, userId])\n    }\n    return { success: true }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error agregar puntos:\", error)\n    return { success: false }\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 505, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,iQAAO,EAAC,IAAA,2NAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 520, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,+QAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,yUAAI,GAAG;IAE9B,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 579, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 681, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst badgeVariants = cva(\n  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',\n  {\n    variants: {\n      variant: {\n        default:\n          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',\n        secondary:\n          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',\n        destructive:\n          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  },\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'span'> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'span'\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,+QAAG,EACvB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,yUAAI,GAAG;IAE9B,qBACE,0YAAC;QACC,aAAU;QACV,WAAW,IAAA,+IAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 727, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/category-icon.tsx"],"sourcesContent":["import { \n  Smartphone, \n  Monitor, \n  Cable, \n  Armchair, \n  BookOpen, \n  Laptop, \n  Drill, \n  Briefcase, \n  Shirt, \n  Home, \n  Dumbbell, \n  Gamepad2, \n  Car, \n  Tv, \n  Package, \n  type LucideIcon \n} from \"lucide-react\"\n\n// Diccionario que mapea IDs numéricos y Slugs a Iconos\nconst categoryIcons: Record<string, LucideIcon> = {\n  // Mapeo por ID (Lo que llega de la BD)\n  \"1\": Smartphone,       // Electrónica\n  \"2\": Armchair,         // Muebles\n  \"3\": Shirt,            // Ropa\n  \"4\": Home,             // Hogar\n  \"5\": Dumbbell,         // Deportes\n  \"6\": BookOpen,         // Libros\n  \"7\": Gamepad2,         // Juguetes\n  \"8\": Drill,            // Herramientas\n  \"9\": Car,              // Vehículos\n  \"10\": Tv,              // Electrodomésticos\n  \"11\": Package,         // Otros\n\n  // Mapeo por Slug \n  electronica: Smartphone,\n  muebles: Armchair,\n  ropa: Shirt,\n  hogar: Home,\n  deportes: Dumbbell,\n  libros: BookOpen,\n  juguetes: Gamepad2,\n  herramientas: Drill,\n  vehiculos: Car,\n  electrodomesticos: Tv,\n  otros: Package,\n  oficina: Briefcase,\n  tecnologia: Laptop,\n  computadores: Laptop,\n  telefonos: Smartphone,\n}\n\ninterface CategoryIconProps {\n  category: string | number\n  className?: string\n}\n\nexport function CategoryIcon({ category, className = \"\" }: CategoryIconProps) {\n  const key = String(category).toLowerCase()\n  \n\n  const Icon = categoryIcons[key] || Package \n  \n  return <Icon className={className} />\n}"],"names":[],"mappings":";;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAmBA,uDAAuD;AACvD,MAAM,gBAA4C;IAChD,uCAAuC;IACvC,KAAK,6UAAU;IACf,KAAK,uUAAQ;IACb,KAAK,8TAAK;IACV,KAAK,4TAAI;IACT,KAAK,uUAAQ;IACb,KAAK,2UAAQ;IACb,KAAK,2UAAQ;IACb,KAAK,8TAAK;IACV,KAAK,wTAAG;IACR,MAAM,qTAAE;IACR,MAAM,oUAAO;IAEb,kBAAkB;IAClB,aAAa,6UAAU;IACvB,SAAS,uUAAQ;IACjB,MAAM,8TAAK;IACX,OAAO,4TAAI;IACX,UAAU,uUAAQ;IAClB,QAAQ,2UAAQ;IAChB,UAAU,2UAAQ;IAClB,cAAc,8TAAK;IACnB,WAAW,wTAAG;IACd,mBAAmB,qTAAE;IACrB,OAAO,oUAAO;IACd,SAAS,0UAAS;IAClB,YAAY,iUAAM;IAClB,cAAc,iUAAM;IACpB,WAAW,6UAAU;AACvB;AAOO,SAAS,aAAa,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAqB;IAC1E,MAAM,MAAM,OAAO,UAAU,WAAW;IAGxC,MAAM,OAAO,aAAa,CAAC,IAAI,IAAI,oUAAO;IAE1C,qBAAO,0YAAC;QAAK,WAAW;;;;;;AAC1B","debugId":null}},
    {"offset": {"line": 793, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/item-action-buttons.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Downloads/zirako2.0/components/item-action-buttons.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/zirako2.0/components/item-action-buttons.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,oaAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0T,GACvV,wFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 807, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/components/item-action-buttons.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Downloads/zirako2.0/components/item-action-buttons.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/zirako2.0/components/item-action-buttons.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,oaAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 821, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 829, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/app/item/%5Bid%5D/page.tsx"],"sourcesContent":["import { cookies } from \"next/headers\"\nimport { verifyToken } from \"@/lib/auth\"\nimport { query } from \"@/lib/db\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { CategoryIcon } from \"@/components/category-icon\"\nimport {\n  ChevronLeft,\n  MapPin,\n  Clock,\n  User,\n  Heart,\n  Share2,\n  Package,\n  Tag,\n  ShoppingCart,\n  Repeat,\n  Gift,\n  AlertTriangle,\n  MessageCircle\n} from \"lucide-react\"\nimport Link from \"next/link\"\nimport Image from \"next/image\"\nimport { notFound } from \"next/navigation\"\nimport ItemActionsButtons from \"@/components/item-action-buttons\" \n\n// Función para obtener los detalles reales del artículo y VENDEDOR desde la BD\nasync function getItemDetails(id: string) {\n  try {\n    const sql = `\n      SELECT \n        i.*,\n        u.nombre AS nombre_vendedor,\n        u.email AS email_vendedor,\n        u.foto_perfil AS foto_vendedor,\n        u.nivel AS nivel_vendedor,\n        c.nombre AS nombre_categoria,\n        c.id AS categoria_id\n      FROM items i\n      JOIN usuarios u ON i.usuario_id = u.id\n      LEFT JOIN categorias c ON i.categoria_id = c.id\n      WHERE i.id = ?\n    `\n    const result = await query<any>(sql, [id])\n    \n    if (result.rows.length === 0) return null\n\n    const item = result.rows[0]\n    \n    // Aumentar contador de visitas\n    await query(\"UPDATE items SET vistas = vistas + 1 WHERE id = ?\", [id])\n\n    return {\n      ...item,\n      imagenes: typeof item.imagenes === \"string\" ? JSON.parse(item.imagenes) : item.imagenes || [],\n      precio: Number(item.precio) || 0,\n      vistas: (item.vistas || 0) + 1\n    }\n  } catch (error) {\n    console.error(\"Error fetching item details:\", error)\n    return null\n  }\n}\n\nasync function getCurrentUserId() {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")?.value\n  if (token) {\n    const payload = verifyToken(token)\n    if (payload) return payload.userId\n  }\n  return null\n}\n\nfunction formatPrice(price: number): string {\n  return new Intl.NumberFormat(\"es-CO\", {\n    style: \"currency\",\n    currency: \"COP\",\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(price)\n}\n\nfunction getTypeLabel(type: string): { label: string; color: string; icon: React.ReactNode } {\n  switch (type) {\n    case \"venta\":\n      return { label: \"Venta\", color: \"bg-emerald-600 text-white\", icon: <ShoppingCart className=\"h-4 w-4\"/> }\n    case \"donacion\":\n      return { label: \"Donación\", color: \"bg-purple-600 text-white\", icon: <Gift className=\"h-4 w-4\"/> }\n    case \"intercambio\":\n      return { label: \"Intercambio\", color: \"bg-orange-500 text-white\", icon: <Repeat className=\"h-4 w-4\"/> }\n    default:\n      return { label: \"Disponible\", color: \"bg-gray-500 text-white\", icon: <Tag className=\"h-4 w-4\"/> }\n  }\n}\n\nexport default async function ItemDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const resolvedParams = await params\n  const id = resolvedParams.id\n  \n  const itemData = await getItemDetails(id)\n  const currentUserId = await getCurrentUserId()\n\n  if (!itemData) {\n    notFound()\n  }\n\n  const isOwner = currentUserId === itemData.usuario_id\n  const typeInfo = getTypeLabel(itemData.tipo)\n  const mainImage = itemData.imagenes.length > 0 ? itemData.imagenes[0] : \"/placeholder.svg\"\n\n  const diasPublicado = Math.floor((new Date().getTime() - new Date(itemData.created_at).getTime()) / (1000 * 60 * 60 * 24))\n  const tiempoTexto = diasPublicado === 0 ? \"Hoy\" : `Hace ${diasPublicado} días`\n\n  return (\n    <div className=\"min-h-screen bg-primary pb-20\">\n      {/* Header Nav */}\n      <div className=\"sticky top-0 z-10 bg-primary/95 backdrop-blur-sm border-b border-white/10\">\n        <div className=\"container mx-auto px-4 py-4 max-w-5xl\">\n          <div className=\"flex items-center justify-between\">\n            <Link href=\"/dashboard\">\n              <Button variant=\"ghost\" className=\"text-primary-foreground hover:bg-white/10 flex items-center gap-2\">\n                <ChevronLeft className=\"h-5 w-5\" />\n                Volver\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"text-primary-foreground hover:bg-white/10\">\n                <Heart className=\"h-5 w-5\" />\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"text-primary-foreground hover:bg-white/10\">\n                <Share2 className=\"h-5 w-5\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8 max-w-5xl\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Columna Izquierda: Imágenes */}\n          <div className=\"space-y-4\">\n            <Card className=\"overflow-hidden bg-secondary border-secondary aspect-square relative\">\n              <Image\n                src={mainImage}\n                alt={itemData.titulo}\n                fill\n                className=\"object-cover\"\n                priority\n              />\n              <Badge className={`absolute top-4 left-4 flex items-center gap-1 ${typeInfo.color}`}>\n                {typeInfo.icon} {typeInfo.label}\n              </Badge>\n               {itemData.estado !== 'disponible' && (\n                  <Badge className=\"absolute top-4 right-4 bg-red-500 text-white flex items-center gap-1\">\n                    <AlertTriangle className=\"h-4 w-4\"/> {itemData.estado.toUpperCase()}\n                  </Badge>\n               )}\n            </Card>\n            {/* Galería */}\n            {itemData.imagenes.length > 1 && (\n              <div className=\"grid grid-cols-4 gap-2\">\n                {itemData.imagenes.map((img: string, index: number) => (\n                  <div key={index} className=\"aspect-square relative rounded-lg overflow-hidden bg-secondary cursor-pointer border-2 border-transparent hover:border-accent\">\n                    <Image src={img} alt={`Vista ${index}`} fill className=\"object-cover\" />\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Columna Derecha: Detalles */}\n          <div className=\"space-y-6\">\n            <div>\n              <div className=\"flex items-start justify-between gap-4 mb-3\">\n                <h1 className=\"text-2xl lg:text-4xl font-bold text-primary-foreground\">{itemData.titulo}</h1>\n                <Badge variant=\"outline\" className=\"text-accent border-accent\">{itemData.condicion}</Badge>\n              </div>\n\n              {itemData.tipo === \"venta\" && itemData.precio > 0 ? (\n                <p className=\"text-4xl font-bold text-accent\">{formatPrice(itemData.precio)}</p>\n              ) : itemData.tipo === \"donacion\" ? (\n                <p className=\"text-3xl font-bold text-purple-400 flex items-center gap-2\"><Gift/> Gratis (Donación)</p>\n              ) : (\n                <p className=\"text-3xl font-bold text-orange-400 flex items-center gap-2\"><Repeat/> Para Intercambio</p>\n              )}\n            </div>\n\n            {/* Metadatos */}\n            <div className=\"flex flex-wrap gap-4 text-primary-foreground/70 text-sm border-y border-white/10 py-4\">\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4 text-accent\" />\n                <span>{itemData.ciudad}, Valle del Cauca</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4 text-accent\" />\n                <span>Publicado: {tiempoTexto}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Package className=\"h-4 w-4 text-accent\" />\n                <span>{itemData.vistas} visitas</span>\n              </div>\n            </div>\n\n            <Card className=\"bg-secondary border-secondary p-5\">\n              <h2 className=\"text-lg font-semibold mb-3 text-primary-foreground\">Descripción</h2>\n              <p className=\"text-primary-foreground/80 leading-relaxed whitespace-pre-line\">{itemData.descripcion}</p>\n            </Card>\n\n            {/* Categoría*/}\n            <div className=\"flex items-center gap-3 p-4 bg-secondary/50 rounded-lg\">\n              <div className=\"bg-accent rounded-lg p-2\">\n                <CategoryIcon category={itemData.categoria_id} className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div className=\"flex flex-col\">\n                <span className=\"text-xs text-primary-foreground/60\">Categoría</span>\n                <span className=\"text-primary-foreground font-semibold capitalize\">{itemData.nombre_categoria || 'General'}</span>\n              </div>\n            </div>\n\n            {/* Información del Vendedor */}\n            <Card className=\"bg-secondary border-secondary p-5\">\n              <h2 className=\"text-lg font-semibold mb-4 text-primary-foreground\">Publicado por</h2>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"relative\">\n                    {itemData.foto_vendedor ? (\n                        <Image src={itemData.foto_vendedor} alt={itemData.nombre_vendedor} width={64} height={64} className=\"rounded-full object-cover\" />\n                    ) : (\n                        <div className=\"bg-primary rounded-full p-4\"><User className=\"h-8 w-8 text-accent\" /></div>\n                    )}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-bold text-lg text-primary-foreground\">{itemData.nombre_vendedor}</p>\n                  <p className=\"text-sm text-primary-foreground/60\">Miembro de la comunidad ZIRAKO</p>\n                </div>\n              </div>\n            </Card>\n\n            {/* BOTONES DE ACCIÓN */}\n            <ItemActionsButtons \n                item={itemData} \n                isOwner={isOwner} \n                currentUserId={currentUserId}\n            />\n\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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","debugId":null}}]
}