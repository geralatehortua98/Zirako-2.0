{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\n// 1. Declarar variable global para evitar m√∫ltiples conexiones en modo desarrollo\ndeclare global {\n  var mysqlPool: mysql.Pool | undefined\n}\n\nlet pool: mysql.Pool\n\n// 2. Configuraci√≥n de la conexi√≥n\n// Usamos las variables de entorno que configuramos en .env.local\nconst dbConfig = {\n  uri: process.env.DATABASE_URL, // Prioridad a la URL completa\n  host: process.env.MYSQL_HOST,\n  user: process.env.MYSQL_USER,\n  password: process.env.MYSQL_PASSWORD,\n  database: process.env.MYSQL_DATABASE,\n  port: Number(process.env.MYSQL_PORT) || 3306,\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true, // Vital para Railway\n  keepAliveInitialDelay: 0,\n}\n\n// 3. L√≥gica Singleton: Si ya existe un pool, √∫salo. Si no, cr√©alo.\nif (!global.mysqlPool) {\n  // Si hay una URL completa (DATABASE_URL), √∫sala\n  if (process.env.DATABASE_URL) {\n      global.mysqlPool = mysql.createPool({\n          uri: process.env.DATABASE_URL,\n          waitForConnections: true,\n          connectionLimit: 10,\n          enableKeepAlive: true\n      })\n  } else {\n      // Si no, usa los par√°metros individuales\n      global.mysqlPool = mysql.createPool(dbConfig)\n  }\n}\n\npool = global.mysqlPool\n\n// 4. Funci√≥n helper para ejecutar queries\nexport async function query<T = any>(sql: string, params?: any[]): Promise<{ rows: T[]; fields?: any }> {\n  try {\n    const [rows, fields] = await pool.execute(sql, params || [])\n    return { rows: rows as T[], fields }\n  } catch (error) {\n    console.error(\"[ZIRAKO DB] Error ejecutando query:\", error)\n    throw error\n  }\n}\n\n// 5. Verificar conexi√≥n (Opcional, para debugging)\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const connection = await pool.getConnection()\n    await connection.ping()\n    connection.release()\n    console.log(\"[ZIRAKO DB] Conexi√≥n a MySQL Railway exitosa\")\n    return true\n  } catch (error) {\n    console.error(\"[ZIRAKO DB] Error conectando a MySQL Railway:\", error)\n    return false\n  }\n}\n\nexport default pool"],"names":[],"mappings":";;;;;;;;AAAA;;AAOA,IAAI;AAEJ,kCAAkC;AAClC,iEAAiE;AACjE,MAAM,WAAW;IACf,KAAK,QAAQ,GAAG,CAAC,YAAY;IAC7B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,UAAU,QAAQ,GAAG,CAAC,cAAc;IACpC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,KAAK;IACxC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AACzB;AAEA,mEAAmE;AACnE,IAAI,CAAC,OAAO,SAAS,EAAE;IACrB,gDAAgD;IAChD,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC1B,OAAO,SAAS,GAAG,+NAAK,CAAC,UAAU,CAAC;YAChC,KAAK,QAAQ,GAAG,CAAC,YAAY;YAC7B,oBAAoB;YACpB,iBAAiB;YACjB,iBAAiB;QACrB;IACJ,OAAO;QACH,yCAAyC;QACzC,OAAO,SAAS,GAAG,+NAAK,CAAC,UAAU,CAAC;IACxC;AACF;AAEA,OAAO,OAAO,SAAS;AAGhB,eAAe,MAAe,GAAW,EAAE,MAAc;IAC9D,IAAI;QACF,MAAM,CAAC,MAAM,OAAO,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK,UAAU,EAAE;QAC3D,OAAO;YAAE,MAAM;YAAa;QAAO;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,MAAM;IACR;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,MAAM,WAAW,IAAI;QACrB,WAAW,OAAO;QAClB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO;IACT;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/auth.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport jwt from \"jsonwebtoken\"\nimport { query } from \"./db\"\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"zirako-secret-key-2024-change-in-production\"\nconst JWT_EXPIRES_IN = \"7d\"\n\n// Interfaz para el payload del JWT\nexport interface JWTPayload {\n  userId: number\n  email: string\n  name: string\n}\n\n// Interfaz para los datos de registro\ninterface RegisterProps {\n  email: string\n  password: string\n  name: string\n  rol_id: number // Ahora es el ID de la tabla roles\n  tipo_documento: string\n  numero_documento: string\n  phone?: string\n  ciudad?: string\n  direccion?: string\n}\n\n// Hash de contrase√±a\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = await bcrypt.genSalt(12)\n  return bcrypt.hash(password, salt)\n}\n\n// Verificar contrase√±a\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\n// Generar token JWT\nexport function generateToken(payload: JWTPayload): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\n}\n\n// Verificar token JWT\nexport function verifyToken(token: string): JWTPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as JWTPayload\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al verificar token:\", error)\n    return null\n  }\n}\n\n// Generar token de verificaci√≥n de email\nexport function generateVerificationToken(): string {\n  return jwt.sign({ purpose: \"email-verification\" }, JWT_SECRET, { expiresIn: \"24h\" })\n}\n\n// Generar token de recuperaci√≥n de contrase√±a\nexport function generatePasswordResetToken(): string {\n  return jwt.sign({ purpose: \"password-reset\" }, JWT_SECRET, { expiresIn: \"1h\" })\n}\n\n// Registrar nuevo usuario\nexport async function registerUser({\n  email,\n  password,\n  name,\n  rol_id,\n  tipo_documento,\n  numero_documento,\n  phone,\n  ciudad,\n  direccion\n}: RegisterProps) {\n  try {\n    // Verificar si el usuario ya existe\n    const existingUser = await query<any>(\"SELECT id FROM usuarios WHERE email = ?\", [email])\n    if (existingUser.rows.length > 0) {\n      return { success: false, error: \"El correo electr√≥nico ya est√° registrado\" }\n    }\n\n    // Verificar si el documento ya existe\n    const existingDoc = await query<any>(\"SELECT id FROM usuarios WHERE numero_documento = ?\", [numero_documento])\n    if (existingDoc.rows.length > 0) {\n      return { success: false, error: \"El n√∫mero de documento ya est√° registrado\" }\n    }\n\n    // Hash de la contrase√±a\n    const passwordHash = await hashPassword(password)\n    const verificationToken = generateVerificationToken()\n\n    // Insertar usuario (usando rol_id)\n    await query<any>(\n      `INSERT INTO usuarios (\n          email, password_hash, nombre, rol_id, tipo_documento, numero_documento, \n          telefono, ciudad, direccion, token_verificacion, puntos, nivel\n       ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0, 1)`,\n      [\n        email, \n        passwordHash, \n        name, \n        rol_id || 1, // Por defecto rol 1 (Persona) si no viene\n        tipo_documento || 'CC', \n        numero_documento, \n        phone || null, \n        ciudad || \"Cali\", \n        direccion || null, \n        verificationToken\n      ],\n    )\n\n    // Obtener el usuario insertado con el nombre de su rol\n    const newUser = await query<any>(\n      `SELECT u.id, u.email, u.nombre, r.nombre as rol, u.created_at \n       FROM usuarios u \n       JOIN roles r ON u.rol_id = r.id \n       WHERE u.email = ?`,\n      [email],\n    )\n\n    const user = newUser.rows[0]\n\n    return {\n      success: true,\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.nombre,\n        rol: user.rol, // Devolvemos el nombre del rol (ej: 'empresa')\n        createdAt: user.created_at,\n      },\n      verificationToken,\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error registro:\", error)\n    return { success: false, error: \"Error interno al registrar\" }\n  }\n}\n\n// Iniciar sesi√≥n\nexport async function loginUser(email: string, password: string) {\n  try {\n    // Buscar usuario por email y obtener el nombre de su rol\n    const result = await query<any>(\n      `SELECT u.id, u.email, u.password_hash, u.nombre, r.nombre as rol, \n              u.telefono, u.ciudad, u.puntos, u.nivel, u.email_verificado \n       FROM usuarios u\n       JOIN roles r ON u.rol_id = r.id\n       WHERE u.email = ?`,\n      [email],\n    )\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Credenciales inv√°lidas\" }\n    }\n\n    const user = result.rows[0]\n\n    // Verificar contrase√±a\n    const isValidPassword = await verifyPassword(password, user.password_hash)\n\n    if (!isValidPassword) {\n      return { success: false, error: \"Credenciales inv√°lidas\" }\n    }\n\n    await query(\"UPDATE usuarios SET ultimo_login = NOW() WHERE id = ?\", [user.id])\n\n    // Generar token JWT\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n      name: user.nombre,\n    })\n\n    return {\n      success: true,\n      token,\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.nombre,\n        rol: user.rol,\n        phone: user.telefono,\n        city: user.ciudad,\n        points: user.puntos,\n        level: user.nivel || 1,\n        emailVerified: user.email_verificado,\n      },\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al iniciar sesi√≥n:\", error)\n    return { success: false, error: \"Error al iniciar sesi√≥n\" }\n  }\n}\n\n// Verificar email\nexport async function verifyEmail(token: string) {\n  try {\n    const result = await query<any>(\"SELECT id, email, nombre FROM usuarios WHERE token_verificacion = ?\", [token])\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Token de verificaci√≥n inv√°lido\" }\n    }\n\n    const user = result.rows[0]\n\n    await query(\"UPDATE usuarios SET email_verificado = TRUE, token_verificacion = NULL WHERE id = ?\", [user.id])\n\n    return { success: true, message: \"Email verificado exitosamente\", user }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error al verificar email:\", error)\n    return { success: false, error: \"Error al verificar email\" }\n  }\n}\n\n// Solicitar recuperaci√≥n de contrase√±a\nexport async function requestPasswordReset(email: string) {\n  try {\n    const result = await query<any>(\"SELECT id, nombre FROM usuarios WHERE email = ?\", [email])\n\n    if (result.rows.length === 0) {\n      return { success: true, message: \"Si el correo existe, recibir√°s un enlace de recuperaci√≥n\" }\n    }\n\n    const user = result.rows[0]\n    const resetToken = generatePasswordResetToken()\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000) // 1 hora\n\n    await query(\"UPDATE usuarios SET token_reset_password = ?, reset_password_expira = ? WHERE id = ?\", [\n      resetToken,\n      expiresAt,\n      user.id,\n    ])\n\n    return { success: true, resetToken, user }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error recuperaci√≥n contrase√±a:\", error)\n    return { success: false, error: \"Error al procesar la solicitud\" }\n  }\n}\n\n// Restablecer contrase√±a\nexport async function resetPassword(token: string, newPassword: string) {\n  try {\n    const result = await query<any>(\n      \"SELECT id FROM usuarios WHERE token_reset_password = ? AND reset_password_expira > NOW()\",\n      [token],\n    )\n\n    if (result.rows.length === 0) {\n      return { success: false, error: \"Token inv√°lido o expirado\" }\n    }\n\n    const user = result.rows[0]\n    const passwordHash = await hashPassword(newPassword)\n\n    await query(\n      \"UPDATE usuarios SET password_hash = ?, token_reset_password = NULL, reset_password_expira = NULL WHERE id = ?\",\n      [passwordHash, user.id],\n    )\n\n    return { success: true, message: \"Contrase√±a actualizada exitosamente\" }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error restablecer contrase√±a:\", error)\n    return { success: false, error: \"Error al restablecer contrase√±a\" }\n  }\n}\n\n// Obtener usuario por ID (con rol desde la tabla roles)\nexport async function getUserById(id: number) {\n  try {\n    const result = await query<any>(\n      `SELECT u.id, u.email, u.nombre, r.nombre as rol, u.telefono, u.ciudad, u.direccion, \n              u.puntos, u.nivel, u.email_verificado, u.created_at \n       FROM usuarios u\n       JOIN roles r ON u.rol_id = r.id\n       WHERE u.id = ?`,\n      [id],\n    )\n\n    if (result.rows.length === 0) return null\n\n    const user = result.rows[0]\n    return {\n      id: user.id,\n      email: user.email,\n      name: user.nombre,\n      rol: user.rol,\n      phone: user.telefono,\n      city: user.ciudad,\n      address: user.direccion,\n      points: user.puntos,\n      level: user.nivel || 1,\n      emailVerified: user.email_verificado,\n      createdAt: user.created_at,\n    }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error obtener usuario:\", error)\n    return null\n  }\n}\n\nexport async function addPointsToUser(userId: number, points: number, reason: string) {\n  try {\n    await query(\"UPDATE usuarios SET puntos = puntos + ? WHERE id = ?\", [points, userId])\n\n    // Recalcular nivel\n    const result = await query<any>(\"SELECT puntos FROM usuarios WHERE id = ?\", [userId])\n    if (result.rows.length > 0) {\n      const totalPoints = result.rows[0].puntos\n      let newLevel = 1\n      if (totalPoints >= 1000) newLevel = 5 \n      else if (totalPoints >= 500) newLevel = 4 \n      else if (totalPoints >= 200) newLevel = 3 \n      else if (totalPoints >= 50) newLevel = 2 \n\n      await query(\"UPDATE usuarios SET nivel = ? WHERE id = ?\", [newLevel, userId])\n    }\n    return { success: true }\n  } catch (error) {\n    console.error(\"[ZIRAKO AUTH] Error agregar puntos:\", error)\n    return { success: false }\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 581, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/lib/email.tsx"],"sourcesContent":["import nodemailer from \"nodemailer\"\n\n/**\n * CONFIGURACI√ìN DE CORREO ELECTR√ìNICO - ZIRAKO\n */\n\nexport interface EmailOptions {\n  to: string\n  subject: string\n  html: string\n  text?: string\n  replyTo?: string\n}\n\n// Crear transportador SMTP (singleton)\nlet transporter: nodemailer.Transporter | null = null\n\nfunction getTransporter(): nodemailer.Transporter {\n  if (!transporter) {\n    transporter = nodemailer.createTransport({\n      host: process.env.SMTP_HOST || \"smtp.mi.com.co\",\n      port: Number.parseInt(process.env.SMTP_PORT || \"465\"),\n      secure: process.env.SMTP_SECURE === \"true\" || true,\n      auth: {\n        user: process.env.SMTP_USER || \"geraldine@mi.com.co\",\n        pass: process.env.SMTP_PASSWORD || \"Horoscopo12*\",\n      },\n    })\n  }\n  return transporter\n}\n\nexport async function sendEmail(options: EmailOptions) {\n  try {\n    const transporter = getTransporter()\n\n    const info = await transporter.sendMail({\n      from: '\"ZIRAKO\" <geraldine@mi.com.co>',\n      replyTo: options.replyTo || \"soporte@zirako.co\",\n      to: options.to,\n      subject: options.subject,\n      text: options.text,\n      html: options.html,\n    })\n\n    console.log(\"[ZIRAKO EMAIL] Correo enviado:\", info.messageId, \"a:\", options.to)\n    return { success: true, messageId: info.messageId }\n  } catch (error) {\n    console.error(\"[ZIRAKO EMAIL] Error al enviar correo:\", error)\n    throw error \n  }\n}\n\n// ==========================================\n// PLANTILLA BASE (ESTRUCTURA DE LOS OTROS)\n// ==========================================\n\n// LOGO HEXAGONAL BLANCO\nconst ZIRAKO_LOGO_SVG = `\n<svg width=\"64\" height=\"64\" viewBox=\"0 0 48 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style=\"display: block; margin: 0 auto;\">\n  <path d=\"M24 4L42 14V34L24 44L6 34V14L24 4Z\" fill=\"white\" stroke=\"white\" stroke-width=\"2\" />\n</svg>\n`\n\n// HEADER VERDE\nconst EMAIL_HEADER = `\n  <div style=\"background: linear-gradient(135deg, #1a5f3a 0%, #2d8659 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\n    <div style=\"margin-bottom: 15px;\">\n      ${ZIRAKO_LOGO_SVG}\n    </div>\n    <h1 style=\"margin: 0; font-size: 28px; letter-spacing: 3px; font-weight: 800;\">ZIRAKO</h1>\n    <p style=\"margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;\">Reutiliza con prop√≥sito</p>\n  </div>\n`\n\n// FOOTER\nconst EMAIL_FOOTER = `\n  <div style=\"text-align: center; margin-top: 20px; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #eee;\">\n    <p style=\"margin: 0;\">¬© 2025 ZIRAKO - Todos los derechos reservados</p>\n    <p style=\"margin: 5px 0 0 0;\">Cali, Valle del Cauca, Colombia</p>\n    <p style=\"margin: 10px 0 0 0;\">\n      <a href=\"https://zirako-delta.vercel.app/\" style=\"color: #1a5f3a; text-decoration: none;\">zirako.co</a>\n    </p>\n  </div>\n`\n\n// ==========================================\n// FUNCIONES DE ENV√çO\n// ==========================================\n\n/**\n * 1. Enviar correo de bienvenida al registrarse\n */\nexport async function sendWelcomeEmail(email: string, name: string) {\n  const html = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #1a5f3a; text-align: center;\">¬°Bienvenido/a, ${name}! üå±</h2>\n            <p style=\"font-size: 16px; line-height: 1.6; color: #333;\">Gracias por unirte a <strong>ZIRAKO</strong>. Estamos emocionados de tenerte como parte de nuestra comunidad de econom√≠a circular en el Valle del Cauca.</p>\n            \n            <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n              <p style=\"margin: 5px 0;\">‚úÖ <strong>Publica</strong> art√≠culos que ya no uses.</p>\n              <p style=\"margin: 5px 0;\">‚úÖ <strong>Encuentra</strong> tesoros a precios justos.</p>\n              <p style=\"margin: 5px 0;\">‚úÖ <strong>Ayuda</strong> al planeta reduciendo residuos.</p>\n            </div>\n\n            <center>\n              <a href=\"https://zirako-delta.vercel.app/auth/login\" style=\"display: inline-block; background: #1a5f3a; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px;\">Explorar ZIRAKO</a>\n            </center>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n  return sendEmail({ to: email, subject: \"¬°Bienvenido/a a ZIRAKO! üå±\", html })\n}\n\n/**\n * 2. Enviar contrase√±a temporal\n */\nexport async function sendTemporaryPasswordEmail(email: string, name: string, temporaryPassword: string) {\n  const html = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #1a5f3a; text-align: center;\">Recuperaci√≥n de Cuenta</h2>\n            <p>Hola ${name}, hemos recibido una solicitud para restablecer tu contrase√±a. Aqu√≠ est√° tu clave temporal:</p>\n            \n            <div style=\"background: white; padding: 20px; text-align: center; border: 2px solid #1a5f3a; border-radius: 8px; margin: 25px 0;\">\n              <p style=\"font-size: 28px; font-weight: bold; color: #1a5f3a; margin: 0; letter-spacing: 2px;\">${temporaryPassword}</p>\n            </div>\n            \n            <div style=\"background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 20px;\">\n              <p style=\"margin: 0; font-size: 14px; color: #856404;\">‚ö†Ô∏è Por seguridad, te recomendamos cambiar esta contrase√±a inmediatamente despu√©s de iniciar sesi√≥n.</p>\n            </div>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n  return sendEmail({ to: email, subject: \"üîê Tu nueva contrase√±a temporal\", html })\n}\n\n/**\n * 3. Enviar notificaci√≥n de recolecci√≥n (ACTUALIZADA MULTI-DESTINATARIO)\n * Usa la misma plantilla pero a√±ade el bloque del C√≥digo de Servicio\n */\nexport async function sendCollectionConfirmationEmail(\n  userEmail: string,\n  userName: string,\n  recolectorEmail: string,\n  recolectorName: string,\n  codigoRecoleccion: string, // <-- AQU√ç ENTRA EL C√ìDIGO\n  fecha: string,\n  horario: string,\n  direccion: string,\n  ciudad: string,\n  descripcion: string,\n) {\n  const commonHtml = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #1a5f3a; text-align: center;\">üöö Nueva Recolecci√≥n Programada</h2>\n            <p style=\"text-align: center; color: #666;\">Se ha agendado una recolecci√≥n a trav√©s de ZIRAKO.</p>\n            \n            <!-- BLOQUE DE C√ìDIGO DE RECOLECCI√ìN DESTACADO -->\n            <div style=\"background: #1a5f3a; color: white; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;\">\n              <p style=\"margin: 0; font-size: 14px; opacity: 0.9; text-transform: uppercase;\">C√≥digo de Servicio</p>\n              <p style=\"margin: 5px 0 0 0; font-size: 32px; font-weight: 800; letter-spacing: 2px;\">${codigoRecoleccion}</p>\n            </div>\n            \n            <div style=\"background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #1a5f3a; box-shadow: 0 2px 4px rgba(0,0,0,0.05);\">\n              <h3 style=\"margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px;\">Detalles de la Orden</h3>\n              <p style=\"margin: 8px 0;\"><strong>üë§ Solicitante:</strong> ${userName}</p>\n              <p style=\"margin: 8px 0;\"><strong>üè¢ Empresa Recolectora:</strong> ${recolectorName}</p>\n              <p style=\"margin: 8px 0;\"><strong>üìÖ Fecha:</strong> ${fecha}</p>\n              <p style=\"margin: 8px 0;\"><strong>üïê Horario:</strong> ${horario}</p>\n              <p style=\"margin: 8px 0;\"><strong>üìç Direcci√≥n:</strong> ${direccion}, ${ciudad}</p>\n              <p style=\"margin: 8px 0;\"><strong>üì¶ Materiales:</strong> ${descripcion}</p>\n            </div>\n            \n            <p style=\"text-align: center; font-size: 12px; color: #666; margin-top: 20px;\">\n              Este c√≥digo debe presentarse al momento de la recolecci√≥n.\n            </p>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n\n  // 1. Correo al Usuario Creador\n  await sendEmail({\n    to: userEmail,\n    subject: `‚úÖ Recolecci√≥n Confirmada [${codigoRecoleccion}]`,\n    html: commonHtml,\n  })\n\n  // 2. Correo a la Empresa Recolectora\n  await sendEmail({\n    to: recolectorEmail,\n    subject: `üöö Nueva Solicitud de Recolecci√≥n [${codigoRecoleccion}]`,\n    html: commonHtml,\n  })\n\n  // 3. Correo al Admin (Geraldine)\n  await sendEmail({\n    to: \"geraldine@mi.com.co\",\n    subject: `üîî Admin: Nueva Recolecci√≥n [${codigoRecoleccion}]`,\n    html: commonHtml,\n  })\n\n  return { success: true }\n}\n\n/**\n * 4. Enviar ticket de soporte\n */\nexport async function sendSupportTicketEmail(\n  ticketId: string | number,\n  email: string,\n  name: string,\n  asunto: string,\n  mensaje: string,\n) {\n  const adminHtml = `\n    <div style=\"font-family: Arial;\">\n      <h2 style=\"color: #9b59b6;\">üé´ Nuevo Ticket de Soporte</h2>\n      <p><strong>Ticket ID:</strong> #${ticketId}</p>\n      <p><strong>De:</strong> ${name} (<a href=\"mailto:${email}\">${email}</a>)</p>\n      <p><strong>Asunto:</strong> ${asunto}</p>\n      <div style=\"background: #f9f9f9; padding: 15px; border-left: 4px solid #9b59b6;\">\n        ${mensaje}\n      </div>\n    </div>\n  `\n\n  const clientHtml = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #1a5f3a; text-align: center;\">Ticket Recibido</h2>\n            <p>Hola ${name}, hemos recibido tu solicitud de soporte.</p>\n            \n            <div style=\"background: #1a5f3a; color: white; padding: 20px; border-radius: 8px; text-align: center; margin: 25px 0;\">\n              <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">N√∫mero de Ticket</p>\n              <p style=\"margin: 5px 0 0 0; font-size: 32px; font-weight: bold;\">${ticketId}</p>\n            </div>\n            \n            <p><strong>Asunto:</strong> ${asunto}</p>\n            <p style=\"color: #666; font-size: 14px;\">Nuestro equipo revisar√° tu caso y te responder√° en un plazo de 24 a 48 horas.</p>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n\n  await sendEmail({ to: \"geraldine@mi.com.co\", subject: `üé´ Ticket [${ticketId}]: ${asunto}`, html: adminHtml, replyTo: email })\n  await sendEmail({ to: email, subject: `‚úÖ Ticket Recibido [${ticketId}]`, html: clientHtml })\n\n  return { success: true }\n}\n\n/**\n * 5. Enviar mensaje de chat de soporte\n */\nexport async function sendChatSupportEmail(name: string, email: string, message: string) {\n  const html = `\n    <div style=\"font-family: Arial;\">\n      <h2 style=\"color: #3498db;\">üí¨ Nuevo Mensaje de Chat</h2>\n      <p><strong>Usuario:</strong> ${name}</p>\n      <p><strong>Email:</strong> ${email}</p>\n      <div style=\"background: #f0f7fb; padding: 15px; border-radius: 5px; border: 1px solid #cceeff;\">\n        ${message}\n      </div>\n      <p style=\"font-size: 12px; color: #666;\">Responde a este correo para contestar directamente al usuario.</p>\n    </div>\n  `\n  return sendEmail({ to: \"geraldine@mi.com.co\", subject: `üí¨ Chat: ${name}`, html, replyTo: email })\n}\n\n/**\n * 6. Enviar solicitud de intercambio\n */\nexport async function sendExchangeRequestEmail(\n  email: string,\n  name: string,\n  itemTitulo: string,\n  solicitanteNombre: string,\n  itemOfrecido: string,\n) {\n  const html = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #d97706; text-align: center;\">üîÑ Propuesta de Intercambio</h2>\n            <p>Hola ${name},</p>\n            <p><strong>${solicitanteNombre}</strong> est√° interesado en hacer un intercambio contigo.</p>\n            \n            <div style=\"background: white; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0; border: 1px solid #e5e7eb;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <div style=\"width: 45%;\">\n                  <p style=\"font-size: 12px; color: #666; margin-bottom: 5px;\">Tu art√≠culo</p>\n                  <p style=\"font-weight: bold; color: #1a5f3a;\">${itemTitulo}</p>\n                </div>\n                <div style=\"font-size: 24px; color: #d97706;\">‚áÑ</div>\n                <div style=\"width: 45%;\">\n                  <p style=\"font-size: 12px; color: #666; margin-bottom: 5px;\">Te ofrece</p>\n                  <p style=\"font-weight: bold; color: #1a5f3a;\">${itemOfrecido}</p>\n                </div>\n              </div>\n            </div>\n\n            <center>\n              <a href=\"https://zirako-delta.vercel.app/intercambio\" style=\"display: inline-block; background: #d97706; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold;\">Ver Detalles</a>\n            </center>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n  return sendEmail({ to: email, subject: `üîÑ Solicitud de intercambio para \"${itemTitulo}\"`, html })\n}\n\n/**\n * 7. Enviar solicitud de DONACI√ìN\n */\nexport async function sendDonationRequestEmail(\n  email: string,\n  name: string,\n  itemTitulo: string,\n  solicitanteNombre: string,\n  solicitanteEmail: string,\n  mensaje: string\n) {\n  const html = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #9333ea; text-align: center;\">üíú Solicitud de Donaci√≥n</h2>\n            <p>Hola <strong>${name}</strong>,</p>\n            <p>¬°Buenas noticias! <strong>${solicitanteNombre}</strong> est√° interesado en recibir el art√≠culo que est√°s donando.</p>\n            \n            <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #9333ea; box-shadow: 0 2px 4px rgba(0,0,0,0.05);\">\n              <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #666;\">Art√≠culo solicitado:</p>\n              <h3 style=\"margin: 0 0 15px 0; color: #333;\">${itemTitulo}</h3>\n              <p style=\"margin: 0; font-size: 12px; color: #666;\">Mensaje del solicitante:</p>\n              <p style=\"font-style: italic; color: #555; margin-top: 5px;\">\"${mensaje}\"</p>\n            </div>\n\n            <p style=\"text-align: center;\">Puedes ponerte en contacto directamente:</p>\n            <center>\n              <a href=\"mailto:${solicitanteEmail}\" style=\"display: inline-block; background: #9333ea; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold;\">Responder a ${solicitanteNombre}</a>\n            </center>\n            <p style=\"text-align: center; font-size: 12px; color: #666; margin-top: 10px;\">(${solicitanteEmail})</p>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n  return sendEmail({ to: email, subject: `üíú Alguien quiere tu donaci√≥n: \"${itemTitulo}\"`, html, replyTo: solicitanteEmail })\n}\n\n/**\n * 8. Enviar propuesta de COMPRA\n */\nexport async function sendPurchaseProposalEmail(\n  email: string,\n  name: string,\n  itemTitulo: string,\n  solicitanteNombre: string,\n  solicitanteEmail: string,\n  propuesta: string\n) {\n  const html = `\n    <!DOCTYPE html>\n    <html>\n      <head><meta charset=\"UTF-8\"></head>\n      <body>\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; border-radius: 10px;\">\n          ${EMAIL_HEADER}\n          <div style=\"padding: 30px; background-color: #f9f9f9;\">\n            <h2 style=\"color: #059669; text-align: center;\">üí∞ Oferta de Compra</h2>\n            <p>Hola <strong>${name}</strong>,</p>\n            <p><strong>${solicitanteNombre}</strong> est√° interesado en comprar tu art√≠culo y ha enviado una propuesta.</p>\n            \n            <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #059669; box-shadow: 0 2px 4px rgba(0,0,0,0.05);\">\n              <p style=\"margin: 0 0 5px 0; font-size: 12px; color: #666;\">Art√≠culo:</p>\n              <h3 style=\"margin: 0 0 15px 0; color: #333;\">${itemTitulo}</h3>\n              <div style=\"background: #ecfdf5; padding: 10px; border-radius: 5px; border: 1px dashed #059669;\">\n                <p style=\"margin: 0; font-weight: bold; color: #065f46;\">Propuesta:</p>\n                <p style=\"margin: 5px 0 0 0; color: #333;\">${propuesta}</p>\n              </div>\n            </div>\n\n            <center>\n              <a href=\"mailto:${solicitanteEmail}\" style=\"display: inline-block; background: #059669; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold;\">Contactar Comprador</a>\n            </center>\n            <p style=\"text-align: center; font-size: 12px; color: #666; margin-top: 10px;\">o escribe a: ${solicitanteEmail}</p>\n          </div>\n          ${EMAIL_FOOTER}\n        </div>\n      </body>\n    </html>\n  `\n  return sendEmail({ to: email, subject: `üí∞ Oferta de compra para \"${itemTitulo}\"`, html, replyTo: solicitanteEmail })\n}\n\n// Funciones de compatibilidad para c√≥digo antiguo\nexport async function sendVerificationEmail(email: string, name: string, token: string) {\n  return sendWelcomeEmail(email, name)\n}\n\nexport async function sendPasswordResetEmail(email: string, name: string, token: string) {\n  const temporaryPassword = Math.random().toString(36).slice(-8).toUpperCase()\n  return sendTemporaryPasswordEmail(email, name, temporaryPassword)\n}\n\nexport async function sendCollectionReminderEmail(\n  email: string,\n  name: string,\n  collectionId: string,\n  fecha: string,\n  horario: string,\n  direccion: string,\n) {\n  return sendCollectionConfirmationEmail(\n    email,\n    name,\n    \"soporte@zirako.co\",\n    \"ZIRAKO\",\n    collectionId,\n    fecha,\n    horario,\n    direccion,\n    \"Valle del Cauca\",\n    \"\",\n  )\n}\n\nexport async function sendTicketConfirmationEmail(name: string, email: string, ticketId: number) {\n  return { success: true }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1008, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yeral/Downloads/zirako2.0/app/api/collections/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport { verifyToken } from \"@/lib/auth\"\nimport { cookies } from \"next/headers\"\nimport { sendCollectionConfirmationEmail } from \"@/lib/email\"\n\n// --- Genera c√≥digo √∫nico asegurando que no exista ---\nasync function generarCodigoUnico(): Promise<string> {\n  let codigo = \"\";\n  let existe = true;\n  \n  while (existe) {\n    const random = Math.floor(10000 + Math.random() * 90000); // Ej: 54823\n    codigo = `REC-${random}`;\n    \n    const check = await query<any>(\"SELECT id FROM recolecciones WHERE codigo_recoleccion = ?\", [codigo]);\n    if (check.rows.length === 0) {\n      existe = false; // ¬°Est√° libre!\n    }\n  }\n  return codigo;\n}\n\n// GET\nexport async function GET(request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"auth-token\")?.value\n    if (!token) return NextResponse.json({ success: false, error: \"No autorizado\" }, { status: 401 })\n    const payload = verifyToken(token)\n    if (!payload) return NextResponse.json({ success: false, error: \"Token inv√°lido\" }, { status: 401 })\n\n    let sql = `\n      SELECT \n        r.*, \n        u_rec.nombre as recolector_nombre,\n        u_sol.nombre as solicitante_nombre,\n        u_sol.telefono as solicitante_telefono\n      FROM recolecciones r\n      LEFT JOIN usuarios u_rec ON r.recolector_id = u_rec.id\n      LEFT JOIN usuarios u_sol ON r.usuario_id = u_sol.id\n      WHERE 1=1\n    `\n    const params: any[] = []\n\n    sql += \" AND (r.usuario_id = ? OR r.recolector_id = ?)\"\n    params.push(payload.userId, payload.userId)\n\n    sql += \" ORDER BY r.created_at DESC\"\n\n    const result = await query<any>(sql, params)\n    return NextResponse.json({ success: true, data: result.rows })\n  } catch (error) {\n    return NextResponse.json({ success: false, error: \"Error al obtener recolecciones\" }, { status: 500 })\n  }\n}\n\n// POST\nexport async function POST(request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"auth-token\")?.value\n    if (!token) return NextResponse.json({ success: false, error: \"No autorizado\" }, { status: 401 })\n    const payload = verifyToken(token)\n    if (!payload) return NextResponse.json({ success: false, error: \"Token inv√°lido\" }, { status: 401 })\n\n    const body = await request.json()\n    const { direccion, ciudad, fecha, horario, descripcion, recolector_id, tipo_material } = body\n\n    if (!direccion || !fecha || !recolector_id) return NextResponse.json({ success: false, error: \"Faltan datos\" }, { status: 400 })\n\n    const fechaProgramada = new Date(fecha).toISOString().split(\"T\")[0]\n    \n    const codigoRecoleccion = await generarCodigoUnico(); \n\n    await query<any>(\n      `INSERT INTO recolecciones (usuario_id, recolector_id, codigo_recoleccion, direccion, ciudad, fecha_programada, horario_preferido, descripcion, tipo_material, estado)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'pendiente')`,\n      [payload.userId, recolector_id, codigoRecoleccion, direccion, ciudad, fechaProgramada, horario, descripcion, tipo_material || 'Mezclado'],\n    )\n\n    // Notificaci√≥n por correo\n    const empresaResult = await query<any>(\"SELECT email, nombre FROM usuarios WHERE id = ?\", [recolector_id]);\n    \n    if (empresaResult.rows.length > 0) {\n        try {\n            await sendCollectionConfirmationEmail(\n                payload.email, \n                payload.name, \n                empresaResult.rows[0].email, \n                empresaResult.rows[0].nombre, \n                codigoRecoleccion, \n                fechaProgramada, \n                horario, \n                direccion, \n                ciudad, \n                descripcion\n            )\n        } catch(e) {\n            console.error(\"Error enviando email recolecci√≥n\", e)\n        }\n    }\n\n    return NextResponse.json({ success: true, message: \"Recolecci√≥n programada\", data: { id: codigoRecoleccion } }, { status: 201 })\n  } catch (error: any) {\n    console.error(\"Error en POST Collection:\", error)\n    return NextResponse.json({ success: false, error: \"Error al programar: \" + error.message }, { status: 500 })\n  }\n}\n\n// PUT\nexport async function PUT(request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"auth-token\")?.value\n    if (!token) return NextResponse.json({ success: false, error: \"No autorizado\" }, { status: 401 })\n    const payload = verifyToken(token)\n\n    const body = await request.json()\n    const { id, estado } = body\n\n    const recCheck = await query<any>(\"SELECT * FROM recolecciones WHERE id = ?\", [id])\n    if (recCheck.rows.length === 0) return NextResponse.json({ success: false, error: \"No encontrado\" }, { status: 404 })\n    const recoleccion = recCheck.rows[0]\n\n    if (Number(recoleccion.recolector_id) !== Number(payload.userId)) {\n        return NextResponse.json({ success: false, error: \"No tienes permiso\" }, { status: 403 })\n    }\n\n    await query(\"UPDATE recolecciones SET estado = ? WHERE id = ?\", [estado, id])\n\n    if (estado === 'completada') {\n        // Puntos y CO2\n        await query(\"UPDATE usuarios SET puntos = puntos + 50 WHERE id = ?\", [recoleccion.usuario_id])\n        await query(\n            `INSERT INTO impacto_ambiental (usuario_id, tipo_accion, co2_ahorrado, descripcion) \n             VALUES (?, 'recoleccion', 10.0, ?)`,\n            [recoleccion.usuario_id, `Recolecci√≥n ${recoleccion.codigo_recoleccion} completada`]\n        )\n        // Puntos para la empresa \n        await query(\"UPDATE usuarios SET puntos = puntos + 30 WHERE id = ?\", [recoleccion.recolector_id])\n    }\n\n    return NextResponse.json({ success: true, message: \"Estado actualizado\" })\n\n  } catch (error: any) {\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 })\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}